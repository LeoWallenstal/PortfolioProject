@using System.Security.Claims
@model HomeViewModel
@section Scripts {
	<script src="~/js/homepage.js" defer></script>
}

<section class="search-section">
	
	<div class="row m-3 align-items-center">

		<div class="col-auto">
			<label class="col-form-label">Sök efter användare:</label>
		</div>

		<div class="col-md-3">
			<input class="form-control" placeholder="Namn" id="nameSearch"/>
		</div>

		<div class="col-auto">
			<label class="col-form-label">Sök efter kompetens:</label>
		</div>

		<div class="col-md-3">
			<select class="form-select" id="skillSearch">
				<option value="">Välj kompetens</option>
				@foreach (var skill in Model.Skills)
				{
					<option>@skill.Name</option>
				}
			</select>
		</div>
	</div>
</section>

<section class="cv-section">
	<div class="container" id="cvSection">
		<div id="cvCarousel"
			 class="carousel slide"
			 data-bs-interval="false">

				@await Html.PartialAsync("CvCarouselPartial", Model.Cvs)
			
			<button class="carousel-control-prev"
					type="button"
					data-bs-target="#cvCarousel"
					data-bs-slide="prev">
				<span class="carousel-control-prev-icon"></span>
			</button>

			<button class="carousel-control-next"
					type="button"
					data-bs-target="#cvCarousel"
					data-bs-slide="next">
				<span class="carousel-control-next-icon"></span>
			</button>
	</div>
</section>

<section class="project-section" id="recentProjects">
	<h3 class="text-center my-4">Nyligen tillagda projekt</h3>
	@* vill vi ha fler projekt eller bara senaste? 
	ska man kunna klicka på projekt och se mer, 
	typ vilka som är med, skapat av vem osv*@
	<div>
		<div class="row row-cols-1 row-cols-sm-1 row-cols-md-2 row-cols-lg-3 g-3 m-1 justify-content-center">
			@foreach (var project in Model.Projects)
			{
					<div class="card text-center project-card">
						<div class="card-header align-items-center">
						<a asp-controller="Project"
						   asp-action="Details"
						   asp-route-id="@project.Id" class="text-decoration-none text-dark">
						   <p>@project.Title</p>
					   </a>
						</div>
						<div class="card-body">
							<p class="project-meta">Skapat: @project.CreatedDate.ToString("yyyy-MM-dd")</p>
							<p>@project.Description</p>

						<div class="d-flex justify-content-center mt-2">
							@foreach (var user in project.Users.Take(5))
							{
								<div class="participant-img">
									<img src="@user.ProfileImageUrl" />
								</div>
							}
							@if (project.Users.Count > 5)
							{
								<span class="ms-2 small text-muted">+@(@project.Users.Count - 5)</span>
							}
						</div>
						</div>
						@if (User.Identity.IsAuthenticated)
						{
							@*Jämför användarens ID hämtat från inloggnings-claims med ID:n på användare 
							som är kopplade till projektet. Inloggnings-claims är information om den inloggade 
							användaren som systemet sparar och gör tillgänglig under hela sessionen.
							FindFirstValue innebär gå igenom alla claims och hitta den som har Id och ge dess värde*@
							var isParticipant = project.Users.Any(u => u.Id == User.FindFirstValue(ClaimTypes.NameIdentifier));
							<div class="card-footer">

							@if(!isParticipant)
							{
								<form asp-action="JoinProject" asp-controller="Home" method="post">
									<input type="hidden" name="pid" value="@project.Id" />
									<input type="hidden" name="returnUrl" value="@(Context.Request.Path + Context.Request.QueryString + "#recentProjects")"/>
									<button class="border-0"> Delta </button>
								</form>
							}
							else
							{
									<button disabled class="border-0"> Deltar ✔ </button>
							}
							</div>

						}
					</div>
			}
		</div>
	</div>
</section>



