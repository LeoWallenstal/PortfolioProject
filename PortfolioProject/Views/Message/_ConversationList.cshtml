@using Microsoft.AspNet.Identity
@using DataLayer.Data
@using DataLayer.Models.ViewModels
@inject IMessagesService MessagesService

@model List<ConversationListItemViewModel>


<div class="conversation-list">
	<h1>Chattar</h1>

	<!-- Controls -->
	<div class="d-flex flex-column m-auto mt-1 mb-2 px-3 gap-2 w-100 align-items-center">

		<div class="d-flex flex-row search-bar rounded-pill p-2 bg-light w-100">
			<span class="d-inline-flex align-items-center justify-content-center">
				<svg viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
					<g fill-rule="evenodd" transform="translate(-448 -544)">
						<g fill-rule="nonzero">
							<path d="M10.743 2.257a6 6 0 1 1-8.485 8.486 6 6 0 0 1 8.485-8.486zm-1.06 1.06a4.5 4.5 0 1 0-6.365 6.364 4.5 4.5 0 0 0 6.364-6.363z" transform="translate(448 544)"></path>
							<path d="M10.39 8.75a2.94 2.94 0 0 0-.199.432c-.155.417-.23.849-.172 1.284.055.415.232.794.54 1.103a.75.75 0 0 0 1.112-1.004l-.051-.057a.39.39 0 0 1-.114-.24c-.021-.155.014-.356.09-.563.031-.081.06-.145.08-.182l.012-.022a.75.75 0 1 0-1.299-.752z" transform="translate(448 544)"></path>
							<path d="M9.557 11.659c.038-.018.09-.04.15-.064.207-.077.408-.112.562-.092.08.01.143.034.198.077l.041.036a.75.75 0 0 0 1.06-1.06 1.881 1.881 0 0 0-1.103-.54c-.435-.058-.867.018-1.284.175-.189.07-.336.143-.433.2a.75.75 0 0 0 .624 1.356l.066-.027.12-.061z" transform="translate(448 544)"></path>
							<path d="m13.463 15.142-.04-.044-3.574-4.192c-.599-.703.355-1.656 1.058-1.057l4.191 3.574.044.04c.058.059.122.137.182.24.249.425.249.96-.154 1.41l-.057.057c-.45.403-.986.403-1.411.154a1.182 1.182 0 0 1-.24-.182zm.617-.616.444-.444a.31.31 0 0 0-.063-.052c-.093-.055-.263-.055-.35.024l.208.232.207-.206.006.007-.22.257-.026-.024.033-.034.025.027-.257.22-.007-.007zm-.027-.415c-.078.088-.078.257-.023.35a.31.31 0 0 0 .051.063l.205-.204-.233-.209z" transform="translate(448 544)"></path>
						</g>
					</g>
				</svg>
			</span>
			<input id=""
				   class="form-control shadow-none border-0 bg-transparent "
				   type="text"
				   placeholder="Sök..."
				   autocomplete="off" />
		</div>
		<div>
			<div class="btn-row">
				<button type="button"
						class="filter-btn active rounded-pill"
						data-filter="all">
					Alla
				</button>
				<button type="button"
						class="filter-btn rounded-pill"
						data-filter="unread">
					Olästa
				</button>
			</div>
		</div>
	</div>

	<ul class="item-list">
		@foreach (var c in Model)
		{
			var url = c.OtherUsername == null
			? Url.Action("Index", "Messages", new { conversationId = c.ConversationId })
			: Url.Action("Index", "Messages", new { username = c.OtherUsername });

			<li class="conversation-item"
				data-url="@url">

				<div class="profile-pic icon-with-badge">
					<img src="@c.OtherUsersProfileImageUrl"
						 alt="Profile picture"
						 class="avatar-img" />

					@{
						int unread = c.UnreadCount;

						if (unread > 0)
						{
							string n = (unread > 99) ? "99+" : $"{unread}";
							<span class="notification-dot">@n</span>
						}
					}
			</div>

			<div class="conversation-text">
				<a asp-controller="Cv" asp-action="Details" asp-route-username="@c.OtherUsername" class="profile-link">
					<strong>@c.OtherUsersFullName</strong>
				</a>

				<div class="conversation-preview">
					<span> @(c.LastMessageIsMine ? "Du: " : "")@c.Preview</span>
				</div>
			</div>

			<div class="conversation-date">
				@(c.LastSentAt.Date == DateTime.Today
								? c.LastSentAt.ToString("HH:mm")
								: c.LastSentAt.ToString("yyyy-MM-dd"))
			</div>


			</li>
				}
	</ul>
</div>

<style>
	.btn-row {
		display: flex;
		gap: 2px;
	}
	.filter-btn{
		background-color: transparent;
		color: black;
		min-width: 64px;
		border: none;
	}

	.filter-btn.active {
			background-color: rgba(13, 110, 253, 0.12); /* Bootstrap primary, light */
			color: var(--bs-primary);
	}

		.filter-btn:hover {
			background-color: rgba(13, 110, 253, 0.06);
		}
</style>

<script>
	const btns = document.querySelectorAll(".filter-btn");

	btns.forEach(btn => {
	  btn.addEventListener("click", () => {
		// If already active, do nothing (optional safeguard)
		if (btn.classList.contains("active")) return;

		// Remove active from all buttons
		btns.forEach(b => b.classList.remove("active"));

		// Add active to the clicked button
		btn.classList.add("active");
	  });
	});
</script>





